<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ù…Ø¤Ù‚Øª - ÙŠØ¹Ù…Ù„ Ø¨Ø¯ÙˆÙ† Google Apps Script</title>
    <style>
        body { font-family: Arial, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); margin: 0; padding: 20px; min-height: 100vh; }
        .container { max-width: 900px; margin: 0 auto; background: white; border-radius: 15px; padding: 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        .header { text-align: center; margin-bottom: 30px; color: #2c3e50; }
        .status-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 20px 0; }
        .status-card { padding: 20px; border-radius: 10px; text-align: center; }
        .success { background: #d4edda; color: #155724; border: 2px solid #c3e6cb; }
        .warning { background: #fff3cd; color: #856404; border: 2px solid #ffeaa7; }
        .error { background: #f8d7da; color: #721c24; border: 2px solid #f5c6cb; }
        .btn { padding: 12px 25px; margin: 10px 5px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; transition: all 0.3s; }
        .btn-primary { background: #007bff; color: white; }
        .btn-success { background: #28a745; color: white; }
        .btn-warning { background: #ffc107; color: #212529; }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.3); }
        .result { margin: 15px 0; padding: 15px; border-radius: 8px; font-family: monospace; white-space: pre-wrap; }
        .form-section { background: #f8f9fa; padding: 20px; border-radius: 10px; margin: 20px 0; }
        .form-group { margin: 15px 0; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: bold; }
        .form-group input, .form-group select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; }
        .data-display { background: #e9ecef; padding: 15px; border-radius: 8px; margin: 10px 0; max-height: 300px; overflow-y: auto; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸš€ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø¤Ù‚Øª - ÙŠØ¹Ù…Ù„ Ù…Ø­Ù„ÙŠØ§Ù‹</h1>
            <p>Ù†Ø¸Ø§Ù… ÙƒØ§Ù…Ù„ ÙŠØ¹Ù…Ù„ Ø¨Ø¯ÙˆÙ† Ø§Ù„Ø­Ø§Ø¬Ø© Ù„Ù€ Google Apps Script</p>
            <p id="currentTime"></p>
        </div>

        <!-- Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù… -->
        <div class="status-grid">
            <div class="status-card success">
                <h3>âœ… Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ</h3>
                <p>ÙŠØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ Ù…Ø«Ø§Ù„ÙŠ</p>
            </div>
            <div class="status-card success" id="hijriCard">
                <h3>ğŸ“… Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù‡Ø¬Ø±ÙŠ</h3>
                <p id="hijriDate">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p>
            </div>
            <div class="status-card success">
                <h3>ğŸ”„ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ù…Ø­Ù„ÙŠØ©</h3>
                <p>ØªØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ ÙƒØ§Ù…Ù„</p>
            </div>
            <div class="status-card warning">
                <h3>ğŸŒ Google Apps Script</h3>
                <p>ØºÙŠØ± Ù…Ø·Ù„ÙˆØ¨ Ø­Ø§Ù„ÙŠØ§Ù‹</p>
            </div>
        </div>

        <!-- Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª -->
        <div class="form-section">
            <h3>ğŸ“ Ø¥Ø¯Ø®Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</h3>
            <form id="salesForm">
                <div class="form-group">
                    <label>Ø§Ù„ÙØ±Ø¹:</label>
                    <select id="branch" required>
                        <option value="">Ø§Ø®ØªØ± Ø§Ù„ÙØ±Ø¹</option>
                        <option value="Ø§Ù„ÙØ±Ø¹ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ">Ø§Ù„ÙØ±Ø¹ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ</option>
                        <option value="Ø§Ù„ÙØ±Ø¹ Ø§Ù„Ø«Ø§Ù†ÙŠ">Ø§Ù„ÙØ±Ø¹ Ø§Ù„Ø«Ø§Ù†ÙŠ</option>
                        <option value="Ø§Ù„ÙØ±Ø¹ Ø§Ù„Ø«Ø§Ù„Ø«">Ø§Ù„ÙØ±Ø¹ Ø§Ù„Ø«Ø§Ù„Ø«</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Ø§Ù„Ù…Ø³Ø¦ÙˆÙ„:</label>
                    <input type="text" id="responsible" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³Ø¦ÙˆÙ„" required>
                </div>
                <div class="form-group">
                    <label>ÙƒØ§Ø´ (Ø±ÙŠØ§Ù„):</label>
                    <input type="number" id="cash" placeholder="0" min="0" step="0.01">
                </div>
                <div class="form-group">
                    <label>Ù†Ø¸Ø§Ù… Ù†Ù‚Ø§Ø· Ø§Ù„Ø¨ÙŠØ¹ (Ø±ÙŠØ§Ù„):</label>
                    <input type="number" id="pos" placeholder="0" min="0" step="0.01">
                </div>
                <div class="form-group">
                    <label>Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ© (Ø±ÙŠØ§Ù„):</label>
                    <input type="number" id="purchases" placeholder="0" min="0" step="0.01">
                </div>
                <button type="submit" class="btn btn-success">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
            </form>
        </div>

        <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… -->
        <div style="text-align: center; margin: 30px 0;">
            <button class="btn btn-primary" onclick="viewAllData()">ğŸ“Š Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
            <button class="btn btn-warning" onclick="generateReport()">ğŸ“ˆ Ø¥Ù†Ø´Ø§Ø¡ ØªÙ‚Ø±ÙŠØ±</button>
            <button class="btn btn-success" onclick="exportData()">ğŸ“¤ ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
            <button class="btn" style="background: #dc3545; color: white;" onclick="clearAllData()">ğŸ—‘ï¸ Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
        </div>

        <!-- Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ -->
        <div id="results"></div>
    </div>

    <script>
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆÙ‚Øª
        function updateTime() {
            const now = new Date();
            const gregorian = now.toLocaleDateString('ar-SA');
            const hijri = new Intl.DateTimeFormat('ar-SA-u-ca-islamic', {
                year: 'numeric', month: 'long', day: 'numeric'
            }).format(now);
            
            document.getElementById('currentTime').textContent = `${gregorian} - ${hijri}`;
            document.getElementById('hijriDate').textContent = hijri;
        }

        // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        document.getElementById('salesForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const data = {
                id: 'local_' + Date.now(),
                timestamp: new Date().toISOString(),
                gregorianDate: new Date().toLocaleDateString('ar-SA'),
                hijriDate: new Intl.DateTimeFormat('ar-SA-u-ca-islamic', {
                    year: 'numeric', month: '2-digit', day: '2-digit'
                }).format(new Date()),
                branch: document.getElementById('branch').value,
                responsible: document.getElementById('responsible').value,
                cash: parseFloat(document.getElementById('cash').value || 0),
                pos: parseFloat(document.getElementById('pos').value || 0),
                purchases: parseFloat(document.getElementById('purchases').value || 0),
                status: 'saved_locally'
            };
            
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ§Øª
            data.totalSales = data.cash + data.pos;
            data.profit = data.totalSales - data.purchases;
            
            // Ø­ÙØ¸ ÙÙŠ localStorage
            let submissions = JSON.parse(localStorage.getItem('localSubmissions') || '[]');
            submissions.push(data);
            localStorage.setItem('localSubmissions', JSON.stringify(submissions));
            
            // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù†Ø¬Ø§Ø­
            showResult(`âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!

ğŸ“Š Ù…Ù„Ø®Øµ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„:
â€¢ Ø§Ù„ÙØ±Ø¹: ${data.branch}
â€¢ Ø§Ù„Ù…Ø³Ø¦ÙˆÙ„: ${data.responsible}
â€¢ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª: ${data.totalSales.toLocaleString()} Ø±ÙŠØ§Ù„
â€¢ Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª: ${data.purchases.toLocaleString()} Ø±ÙŠØ§Ù„
â€¢ ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­: ${data.profit.toLocaleString()} Ø±ÙŠØ§Ù„
â€¢ Ø§Ù„ØªØ§Ø±ÙŠØ®: ${data.gregorianDate} (${data.hijriDate})
â€¢ Ù…Ø¹Ø±Ù Ø§Ù„Ø¥Ø±Ø³Ø§Ù„: ${data.id}`, 'success');
            
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
            this.reset();
        });

        // Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        function viewAllData() {
            const submissions = JSON.parse(localStorage.getItem('localSubmissions') || '[]');
            
            if (submissions.length === 0) {
                showResult('ğŸ“­ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­ÙÙˆØ¸Ø© Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†.', 'warning');
                return;
            }
            
            let output = `ğŸ“Š Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©: ${submissions.length} Ø¥Ø±Ø³Ø§Ù„\n\n`;
            
            submissions.forEach((submission, index) => {
                output += `${index + 1}. ${submission.branch} - ${submission.responsible}\n`;
                output += `   Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª: ${submission.totalSales.toLocaleString()} | Ø§Ù„Ø±Ø¨Ø­: ${submission.profit.toLocaleString()}\n`;
                output += `   Ø§Ù„ØªØ§Ø±ÙŠØ®: ${submission.gregorianDate}\n\n`;
            });
            
            showResult(output, 'success');
        }

        // Ø¥Ù†Ø´Ø§Ø¡ ØªÙ‚Ø±ÙŠØ± Ø´Ø§Ù…Ù„
        function generateReport() {
            const submissions = JSON.parse(localStorage.getItem('localSubmissions') || '[]');
            
            if (submissions.length === 0) {
                showResult('ğŸ“­ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙ‚Ø±ÙŠØ±.', 'warning');
                return;
            }
            
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
            let totalSales = 0;
            let totalPurchases = 0;
            let totalProfit = 0;
            const branches = {};
            const users = new Set();
            
            submissions.forEach(submission => {
                totalSales += submission.totalSales;
                totalPurchases += submission.purchases;
                totalProfit += submission.profit;
                
                if (!branches[submission.branch]) {
                    branches[submission.branch] = { sales: 0, profit: 0, count: 0 };
                }
                branches[submission.branch].sales += submission.totalSales;
                branches[submission.branch].profit += submission.profit;
                branches[submission.branch].count++;
                
                users.add(submission.responsible);
            });
            
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¶Ø±Ø§Ø¦Ø¨
            const taxAmount = totalProfit * 0.15;
            const netProfit = totalProfit - taxAmount;
            
            let report = `ğŸ“ˆ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„Ø´Ø§Ù…Ù„ - Ù…Ø­Ù…ÙˆØ¯ Ø­Ø³ÙŠÙ†
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“Š Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø§Ù„ÙŠ:
ğŸ’° Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª: ${totalSales.toLocaleString()} Ø±ÙŠØ§Ù„
ğŸ›’ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª: ${totalPurchases.toLocaleString()} Ø±ÙŠØ§Ù„
ğŸ“Š Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø±Ø¨Ø­: ${totalProfit.toLocaleString()} Ø±ÙŠØ§Ù„
ğŸ’¸ Ø§Ù„Ø¶Ø±Ø§Ø¦Ø¨ (15%): ${taxAmount.toLocaleString()} Ø±ÙŠØ§Ù„
ğŸ’µ ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­: ${netProfit.toLocaleString()} Ø±ÙŠØ§Ù„

ğŸ“‹ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø¹Ø§Ù…Ø©:
ğŸ“ Ø¹Ø¯Ø¯ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±: ${submissions.length}
ğŸ¢ Ø¹Ø¯Ø¯ Ø§Ù„ÙØ±ÙˆØ¹: ${Object.keys(branches).length}
ğŸ‘¥ Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†: ${users.size}

ğŸª ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙØ±ÙˆØ¹:`;

            Object.keys(branches).forEach(branch => {
                const data = branches[branch];
                report += `\nâ€¢ ${branch}: ${data.sales.toLocaleString()} Ø±ÙŠØ§Ù„ (${data.count} ØªÙ‚Ø±ÙŠØ±)`;
            });
            
            report += `\n\nğŸ“… ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ‚Ø±ÙŠØ±: ${new Date().toLocaleString('ar-SA')}`;
            
            showResult(report, 'success');
        }

        // ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        function exportData() {
            const submissions = JSON.parse(localStorage.getItem('localSubmissions') || '[]');
            
            if (submissions.length === 0) {
                showResult('ğŸ“­ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„ØªØµØ¯ÙŠØ±.', 'warning');
                return;
            }
            
            const dataStr = JSON.stringify(submissions, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = `sales-data-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            showResult(`âœ… ØªÙ… ØªØµØ¯ÙŠØ± ${submissions.length} Ø¥Ø±Ø³Ø§Ù„ Ø¨Ù†Ø¬Ø§Ø­!
ğŸ“ Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù: sales-data-${new Date().toISOString().split('T')[0]}.json`, 'success');
        }

        // Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        function clearAllData() {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡.')) {
                localStorage.removeItem('localSubmissions');
                showResult('ğŸ—‘ï¸ ØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­.', 'warning');
            }
        }

        // Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
        function showResult(message, type) {
            const results = document.getElementById('results');
            const className = type === 'success' ? 'success' : type === 'warning' ? 'warning' : 'error';
            results.innerHTML = `<div class="result ${className}">${message}</div>`;
        }

        // ØªØ´ØºÙŠÙ„ Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
        window.onload = function() {
            updateTime();
            setInterval(updateTime, 60000); // ØªØ­Ø¯ÙŠØ« ÙƒÙ„ Ø¯Ù‚ÙŠÙ‚Ø©
            
            // Ø¹Ø±Ø¶ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø³Ø±ÙŠØ¹Ø©
            const submissions = JSON.parse(localStorage.getItem('localSubmissions') || '[]');
            if (submissions.length > 0) {
                showResult(`ğŸ“Š Ù…Ø±Ø­Ø¨Ø§Ù‹! Ù„Ø¯ÙŠÙƒ ${submissions.length} Ø¥Ø±Ø³Ø§Ù„ Ù…Ø­ÙÙˆØ¸ Ù…Ø­Ù„ÙŠØ§Ù‹.`, 'success');
            }
        };
    </script>
</body>
</html>