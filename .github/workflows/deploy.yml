name: Ù†Ø´Ø± Ù†Ø¸Ø§Ù… ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„ÙˆØ§Ø¯ÙŠ

on:
  push:
    branches: [ main ]

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
    # 1ï¸âƒ£ Ø³Ø­Ø¨ Ø§Ù„Ù…Ù„ÙØ§Øª Ù…Ù† Ø§Ù„Ø±ÙŠØ¨Ùˆ
    - uses: actions/checkout@v3

    # 2ï¸âƒ£ Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù„ÙØ§Øª Ø¨Ø¹Ø¯ checkout
    - name: Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù„ÙØ§Øª Ø¨Ø¹Ø¯ checkout
      run: |
        echo "Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù„ÙØ§Øª ÙÙŠ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹:"
        ls -R

    # 3ï¸âƒ£ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ù…Ø¬Ù„Ø¯ ÙŠØ­ØªÙˆÙŠ index.html
    - name: Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù…Ø¬Ù„Ø¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹
      id: check_dir
      run: |
        TARGET_DIR=$(find . -type f -name "index.html" -exec dirname {} \; | head -n 1)
        if [ -z "$TARGET_DIR" ]; then
          echo "âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ index.html ÙÙŠ Ø£ÙŠ Ù…ÙƒØ§Ù†!"
          exit 1
        fi
        echo "ğŸ Ù…Ø¬Ù„Ø¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù„Ù„Ù€ GitHub Pages Ù‡Ùˆ: $TARGET_DIR"
        echo "publish_dir=$TARGET_DIR" >> $GITHUB_OUTPUT

    # 4ï¸âƒ£ Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø£Ù…Ø§Ù† (robots.txt)
    - name: Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø£Ù…Ø§Ù†
      run: |
        echo "User-agent: *" > robots.txt
        echo "Disallow: /test-connection.html" >> robots.txt
        echo "Disallow: /alwadiya-test.html" >> robots.txt

    # 5ï¸âƒ£ Ù†Ø´Ø± Ø¹Ù„Ù‰ GitHub Pages
    - name: Ù†Ø´Ø± Ø¥Ù„Ù‰ GitHub Pages
      uses: peaceiris/actions-gh-pages@v3
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        publish_dir: ${{ steps.check_dir.outputs.publish_dir }}
        user_name: "alwadiyayntradingcompany-stack"
        user_email: "your-email@example.com"
