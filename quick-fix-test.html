<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø®ØªØ¨Ø§Ø± Ø³Ø±ÙŠØ¹ - Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¥ØµÙ„Ø§Ø­Ø§Øª</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }
        
        .test-container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .test-header {
            text-align: center;
            margin-bottom: 30px;
            color: #333;
        }
        
        .test-item {
            margin-bottom: 20px;
            padding: 15px;
            border-radius: 10px;
            border: 2px solid #e0e0e0;
        }
        
        .test-item.success {
            border-color: #4CAF50;
            background: rgba(76, 175, 80, 0.1);
        }
        
        .test-item.error {
            border-color: #f44336;
            background: rgba(244, 67, 54, 0.1);
        }
        
        .test-button {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
        }
        
        .test-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .result {
            margin-top: 10px;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
        }
        
        .success-result {
            background: #e8f5e8;
            color: #2e7d32;
            border: 1px solid #4caf50;
        }
        
        .error-result {
            background: #ffebee;
            color: #c62828;
            border: 1px solid #f44336;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-header">
            <h1>ğŸ”§ Ø§Ø®ØªØ¨Ø§Ø± Ø³Ø±ÙŠØ¹ - Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¥ØµÙ„Ø§Ø­Ø§Øª</h1>
            <p>Ù‡Ø°Ø§ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥ØµÙ„Ø§Ø­Ø§Øª ØªØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­</p>
        </div>

        <!-- Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù‡Ø¬Ø±ÙŠ -->
        <div class="test-item" id="hijriTest">
            <h3>ğŸ“… Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù‡Ø¬Ø±ÙŠ Ø§Ù„Ù…Ø­Ø¯Ø«</h3>
            <p>ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ¸Ù‡Ø± Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù‡Ø¬Ø±ÙŠ Ø§Ù„ØµØ­ÙŠØ­ (Ù„ÙŠØ³ 10-01-1446)</p>
            <button class="test-button" onclick="testHijriDate()">Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù‡Ø¬Ø±ÙŠ</button>
            <div class="result" id="hijriResult"></div>
        </div>

        <!-- Ø§Ø®ØªØ¨Ø§Ø± URL Ø§Ù„Ø¬Ø¯ÙŠØ¯ -->
        <div class="test-item" id="urlTest">
            <h3>ğŸŒ Ø§Ø®ØªØ¨Ø§Ø± URL Ø§Ù„Ù…Ø­Ø¯Ø«</h3>
            <p>ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ¹Ù…Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ù…Ø¹ Google Apps Script Ø§Ù„Ø¬Ø¯ÙŠØ¯</p>
            <button class="test-button" onclick="testNewURL()">Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„</button>
            <div class="result" id="urlResult"></div>
        </div>

        <!-- Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ -->
        <div class="test-item" id="formTest">
            <h3>ğŸ“ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù†Ù…ÙˆØ°Ø¬</h3>
            <p>ÙØªØ­ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ ÙˆØ§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù‡Ø¬Ø±ÙŠ</p>
            <button class="test-button" onclick="openForm()">ÙØªØ­ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬</button>
            <button class="test-button" onclick="openSystemTest()">ÙØªØ­ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù†Ø¸Ø§Ù…</button>
        </div>

        <!-- Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ© -->
        <div class="test-item" id="overallResult">
            <h3>ğŸ“Š Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©</h3>
            <div id="overallStatus">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±...</div>
        </div>
    </div>

    <script>
        // URL Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ø§Ù„Ù…Ø­Ø¯Ø«
        const NEW_GOOGLE_APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzKvQxGzJBB_0szSrmQRQckGtEpNr1MzQQe8Fi3mbfgp5dffQW66Jc9NT-vDBsEwE5qDi5SvA/exec';

        let testResults = {
            hijri: false,
            url: false
        };

        // Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù‡Ø¬Ø±ÙŠ Ø§Ù„Ù…Ø­Ø¯Ø«
        function testHijriDate() {
            const resultDiv = document.getElementById('hijriResult');
            resultDiv.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù‡Ø¬Ø±ÙŠ...';
            
            try {
                // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ø§Ù„Ù…Ø­Ø³Ù†Ø©
                const today = new Date();
                
                // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ø³ØªØ®Ø¯Ø§Ù… Intl.DateTimeFormat
                try {
                    const hijriFormatter = new Intl.DateTimeFormat('ar-SA-u-ca-islamic', {
                        year: 'numeric',
                        month: '2-digit', 
                        day: '2-digit'
                    });
                    
                    const hijriParts = hijriFormatter.formatToParts(today);
                    const year = parseInt(hijriParts.find(part => part.type === 'year').value);
                    const month = parseInt(hijriParts.find(part => part.type === 'month').value);
                    const day = parseInt(hijriParts.find(part => part.type === 'day').value);
                    
                    const hijriDate = `${String(day).padStart(2, '0')}-${String(month).padStart(2, '0')}-${year}`;
                    
                    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ø§Ù„ØªØ§Ø±ÙŠØ® Ù„ÙŠØ³ 10-01-1446
                    if (hijriDate === '10-01-1446') {
                        throw new Error('Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù‡Ø¬Ø±ÙŠ Ù„Ø§ ÙŠØ²Ø§Ù„ ÙŠØ¸Ù‡Ø± Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø®Ø§Ø·Ø¦Ø©: 10-01-1446');
                    }
                    
                    resultDiv.textContent = `âœ… Ù†Ø¬Ø­ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±!\\nØ§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù‡Ø¬Ø±ÙŠ Ø§Ù„ØµØ­ÙŠØ­: ${hijriDate}\\nØ§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ÙŠ: ${today.toISOString().split('T')[0]}`;
                    resultDiv.className = 'result success-result';
                    testResults.hijri = true;
                    
                } catch (intlError) {
                    // Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¨Ø¯ÙŠÙ„Ø© Ø§Ù„Ù…Ø­Ø³Ù†Ø©
                    const gYear = today.getFullYear();
                    const gMonth = today.getMonth() + 1;
                    const gDay = today.getDate();
                    
                    const a = Math.floor((14 - gMonth) / 12);
                    const y = gYear - a;
                    const m = gMonth + 12 * a - 3;
                    
                    let jd = gDay + Math.floor((153 * m + 2) / 5) + 365 * y + Math.floor(y / 4) - Math.floor(y / 100) + Math.floor(y / 400) - 32045;
                    jd = jd - 1948084;
                    
                    const hYear = Math.floor((30 * jd + 10646) / 10631);
                    let hMonth = Math.ceil((jd - 29 - 354 * hYear - Math.floor((3 + 11 * hYear) / 30)) / 29.5);
                    if (hMonth < 1) hMonth = 1;
                    if (hMonth > 12) hMonth = 12;
                    
                    let hDay = jd - 354 * hYear - Math.floor((3 + 11 * hYear) / 30) - Math.floor((hMonth - 1) * 29.5) + 1;
                    if (hDay < 1) hDay = 1;
                    if (hDay > 30) hDay = 30;
                    
                    const currentHijriYear = 1446;
                    const finalYear = Math.max(currentHijriYear, Math.min(currentHijriYear + 1, Math.floor(hYear)));
                    
                    const hijriDate = `${String(Math.floor(hDay)).padStart(2, '0')}-${String(Math.floor(hMonth)).padStart(2, '0')}-${finalYear}`;
                    
                    if (hijriDate === '10-01-1446') {
                        throw new Error('Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù‡Ø¬Ø±ÙŠ Ù„Ø§ ÙŠØ²Ø§Ù„ ÙŠØ¸Ù‡Ø± Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø®Ø§Ø·Ø¦Ø©: 10-01-1446');
                    }
                    
                    resultDiv.textContent = `âœ… Ù†Ø¬Ø­ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± (Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¨Ø¯ÙŠÙ„Ø©)!\\nØ§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù‡Ø¬Ø±ÙŠ: ${hijriDate}\\nÙ…Ù„Ø§Ø­Ø¸Ø©: ØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¨Ø¯ÙŠÙ„Ø© Ù„Ø£Ù† Intl ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…`;
                    resultDiv.className = 'result success-result';
                    testResults.hijri = true;
                }
                
            } catch (error) {
                resultDiv.textContent = `âŒ ÙØ´Ù„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±!\\nØ§Ù„Ø®Ø·Ø£: ${error.message}`;
                resultDiv.className = 'result error-result';
                testResults.hijri = false;
            }
            
            updateOverallResult();
        }

        // Ø§Ø®ØªØ¨Ø§Ø± URL Ø§Ù„Ø¬Ø¯ÙŠØ¯
        function testNewURL() {
            const resultDiv = document.getElementById('urlResult');
            resultDiv.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ù…Ø¹ URL Ø§Ù„Ø¬Ø¯ÙŠØ¯...';
            
            fetch(NEW_GOOGLE_APPS_SCRIPT_URL, {
                method: 'GET'
            })
            .then(response => response.text())
            .then(data => {
                resultDiv.textContent = `âœ… Ù†Ø¬Ø­ Ø§Ù„Ø§ØªØµØ§Ù„!\\nURL Ø§Ù„Ø¬Ø¯ÙŠØ¯ ÙŠØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­\\nØ§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©: ${data}`;
                resultDiv.className = 'result success-result';
                testResults.url = true;
                updateOverallResult();
            })
            .catch(error => {
                resultDiv.textContent = `âŒ ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„!\\nURL Ù‚Ø¯ ÙŠØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ ØªØ­Ø¯ÙŠØ«\\nØ§Ù„Ø®Ø·Ø£: ${error.message}`;
                resultDiv.className = 'result error-result';
                testResults.url = false;
                updateOverallResult();
            });
        }

        // ÙØªØ­ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
        function openForm() {
            window.open('ALWADIYAYNFORM.html', '_blank');
        }

        // ÙØªØ­ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù†Ø¸Ø§Ù…
        function openSystemTest() {
            window.open('system-test.html', '_blank');
        }

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©
        function updateOverallResult() {
            const overallDiv = document.getElementById('overallStatus');
            const overallContainer = document.getElementById('overallResult');
            
            const passedTests = Object.values(testResults).filter(result => result === true).length;
            const totalTests = Object.keys(testResults).length;
            
            if (passedTests === totalTests) {
                overallDiv.innerHTML = `
                    <h4 style="color: #4CAF50;">ğŸ‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ù†Ø¬Ø­Øª!</h4>
                    <p>âœ… Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù‡Ø¬Ø±ÙŠ: ${testResults.hijri ? 'ÙŠØ¹Ù…Ù„' : 'Ù„Ø§ ÙŠØ¹Ù…Ù„'}</p>
                    <p>âœ… Ø§Ù„Ø§ØªØµØ§Ù„: ${testResults.url ? 'ÙŠØ¹Ù…Ù„' : 'Ù„Ø§ ÙŠØ¹Ù…Ù„'}</p>
                    <p><strong>Ø§Ù„Ù†Ø¸Ø§Ù… Ø¬Ø§Ù‡Ø² Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…!</strong></p>
                `;
                overallContainer.className = 'test-item success';
            } else {
                overallDiv.innerHTML = `
                    <h4 style="color: #f44336;">âš ï¸ Ø¨Ø¹Ø¶ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª ÙØ´Ù„Øª</h4>
                    <p>${testResults.hijri ? 'âœ…' : 'âŒ'} Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù‡Ø¬Ø±ÙŠ: ${testResults.hijri ? 'ÙŠØ¹Ù…Ù„' : 'Ù„Ø§ ÙŠØ¹Ù…Ù„'}</p>
                    <p>${testResults.url ? 'âœ…' : 'âŒ'} Ø§Ù„Ø§ØªØµØ§Ù„: ${testResults.url ? 'ÙŠØ¹Ù…Ù„' : 'Ù„Ø§ ÙŠØ¹Ù…Ù„'}</p>
                    <p><strong>ÙŠØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</strong></p>
                `;
                overallContainer.className = 'test-item error';
            }
        }

        // ØªØ´ØºÙŠÙ„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        window.addEventListener('load', () => {
            console.log('ğŸ”§ Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø³Ø±ÙŠØ¹...');
            
            // Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù‡Ø¬Ø±ÙŠ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
            setTimeout(() => {
                testHijriDate();
            }, 1000);
            
            // Ø§Ø®ØªØ¨Ø§Ø± URL ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
            setTimeout(() => {
                testNewURL();
            }, 2000);
        });
    </script>
</body>
</html>